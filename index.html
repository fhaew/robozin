<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lotofácil - Jogos Baseados nos Últimos 100 Concursos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    overflow-x: hidden;
    background: #111;
    color: #fff;
  }
  .overlay {
    position: relative;
    z-index: 1;
    background-color: rgba(0,0,0,0.75);
    min-height: 100vh;
    padding: 40px 20px;
    text-align: center;
  }
  h1 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    color: #00ffcc;
    text-shadow: 2px 2px 8px #000;
  }
  .ultimo-resultado {
    margin-bottom: 20px;
    font-weight: bold;
  }
  .controls {
    margin-bottom: 20px;
  }
  input[type=number] {
    width: 60px;
    padding: 5px;
    border-radius: 5px;
    border: none;
    text-align: center;
    font-weight: bold;
  }
  button {
    margin-left: 10px;
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    background-color: #00cc99;
    color: #fff;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #009966;
  }
  button.delete-btn {
    background-color: #cc0000;
  }
  button.delete-btn:hover {
    background-color: #990000;
  }
  .jogos-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .jogo {
    background: rgba(255,255,255,0.9);
    color: #2c3e50;
    border-radius: 12px;
    padding: 20px;
    width: 260px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    text-align: center;
    font-weight: bold;
  }
  .numeros {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    margin-bottom: 10px;
  }
  .bola {
    width: 32px;
    height: 32px;
    background-color: #5e1699;
    border-radius: 50%;
    color: #fff;
    font-weight: bold;
    font-size: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .stats {
    font-size: 14px;
    color: #444;
  }
  @media(max-width:600px){
    .jogo {
      width: 90%;
    }
  }
</style>
</head>
<body>
  <div class="overlay">
    <h1>Jogos Inteligentes Lotofácil</h1>
    <div class="ultimo-resultado" id="ultimoResultadoText">
      Carregando últimos resultados...
    </div>

    <div class="controls">
      <label for="quantidadeJogos">Qtd de jogos:</label>
      <input type="number" id="quantidadeJogos" min="1" max="100" value="10" />
      <button onclick="gerarJogosBaseados()">Gerar Jogos</button>
      <button class="delete-btn" onclick="apagarJogos()">Apagar Jogos</button>
    </div>

    <div class="jogos-container" id="jogosContainer"></div>
  </div>

<script>
  let ultimosResultados = [];
  let frequencias = Array(25).fill(0);
  let dezenasQuentes = [];

  async function puxarUltimos100() {
    try {
      const response = await fetch('https://brasilapi.com.br/api/lottery/v1/lotofacil/latest');
      if (!response.ok) throw new Error('API última result não acessível');

      const latestData = await response.json();
      let concursos = [];
      let ultimoNumero = latestData.contestNumber || latestData.numeroConcurso || 0;
      if(ultimoNumero === 0) throw new Error('Número do último concurso inválido');

      if(ultimosResultados.length > 0){
        const maisRecente = ultimosResultados[0]?.numeroConcurso || ultimosResultados[0]?.contestNumber || 0;
        if(ultimoNumero > maisRecente){
          const res = await fetch(`https://brasilapi.com.br/api/lottery/v1/lotofacil/${ultimoNumero}`);
          if(res.ok){
            const data = await res.json();
            let dezenasNovo = [];
            if(Array.isArray(data.numbers)) dezenasNovo = data.numbers.map(x => parseInt(x));
            else if(Array.isArray(data.dezenas)) dezenasNovo = data.dezenas.map(x => parseInt(x));
            else if(Array.isArray(data.resultado)) dezenasNovo = data.resultado.map(x => parseInt(x));
            else if(Array.isArray(data.listaDezenas)) dezenasNovo = data.listaDezenas.map(x => parseInt(x));
            if(dezenasNovo.length === 15){
              ultimosResultados.unshift(dezenasNovo);
              if(ultimosResultados.length > 100){
                ultimosResultados.pop();
              }
            }
            return ultimosResultados;
          }
        } else {
          return ultimosResultados;
        }
      }

      for(let i=0; i<100; i++){
        const n = ultimoNumero - i;
        const res = await fetch(`https://brasilapi.com.br/api/lottery/v1/lotofacil/${n}`);
        if(res.ok){
          const data = await res.json();
          concursos.push(data);
        } else {
          break;
        }
      }
      ultimosResultados = concursos.map(c => {
        if(Array.isArray(c.numbers)) return c.numbers.map(x=>parseInt(x));
        else if(Array.isArray(c.dezenas)) return c.dezenas.map(x=>parseInt(x));
        else if(Array.isArray(c.resultado)) return c.resultado.map(x=>parseInt(x));
        else if(Array.isArray(c.listaDezenas)) return c.listaDezenas.map(x=>parseInt(x));
        else return [];
      }).filter(r=>r.length===15);

      return ultimosResultados;
    } catch(e) {
      console.warn('Falha ao buscar API. Usando dados simulados.', e);
      return ultimosResultados.length > 0 ? ultimosResultados : [
        [1, 2, 4, 5, 7, 8, 10, 11, 13, 15, 18, 20, 21, 24, 25],
        [3, 4, 5, 7, 9, 11, 12, 13, 15, 17, 18, 19, 21, 23, 24],
        [2, 3, 5, 6, 8, 10, 11, 13, 14, 15, 17, 20, 21, 22, 25]
      ];
    }
  }

  function processarConcursos(concursos){
    ultimosResultados = concursos.filter(r => r.length === 15);

    frequencias = Array(25).fill(0);

    ultimosResultados.forEach(jogo => {
      jogo.forEach(dz => {
        if(dz >= 1 && dz <= 25) frequencias[dz - 1]++;
      });
    });

    const dezenasOrdenadas = frequencias
      .map((freq, idx) => ({dezena: idx+1, freq}))
      .sort((a,b) => b.freq - a.freq);

    dezenasQuentes = dezenasOrdenadas.slice(0, 20).map(d => d.dezena);

    const ultimoJogo = ultimosResultados[0] || [];
    document.getElementById('ultimoResultadoText').textContent =
      'Último Resultado: ' + ultimoJogo.map(n => n.toString().padStart(2,'0')).join(' - ');

    return dezenasQuentes;
  }

  function gerarJogoBaseado() {
    const jogo = new Set();

    const ultimo = ultimosResultados[0] || [];

    const repeticoes = Math.floor(Math.random() * 3) + 9;

    let copiaQuentes = [...dezenasQuentes];

    while (jogo.size < repeticoes && copiaQuentes.length > 0) {
      const possiveis = copiaQuentes.filter(dz => ultimo.includes(dz));
      if (possiveis.length === 0) break;
      const idx = Math.floor(Math.random() * possiveis.length);
      const dez = possiveis.splice(idx, 1)[0];
      copiaQuentes = copiaQuentes.filter(dz => dz !== dez);
      jogo.add(dez);
    }

    while (jogo.size < 15) {
      const idx = Math.floor(Math.random() * dezenasQuentes.length);
      const dez = dezenasQuentes[idx];
      if (!jogo.has(dez)) jogo.add(dez);
    }

    const numeros = Array.from(jogo).sort((a,b) => a-b);

    const pares = numeros.filter(n => n % 2 === 0).length;
    if(pares < 6 || pares > 9) return gerarJogoBaseado();

    const soma = numeros.reduce((a,b) => a+b, 0);
    if(soma < 180 || soma > 220) return gerarJogoBaseado();

    let maxSeq = 1, seq = 1;
    for(let i=1; i<numeros.length; i++){
      if(numeros[i] === numeros[i-1]+1) seq++;
      else seq = 1;
      if(seq > maxSeq) maxSeq = seq;
    }
    if(maxSeq > 4) return gerarJogoBaseado();

    return numeros;
  }

  function calcularForcaJogo(repetidas, pares, soma) {
    let score = 0;
    if (repetidas >= 9 && repetidas <= 11) score += 40;
    else if (repetidas >= 7 && repetidas <= 12) score += 25;
    else score += 10;

    if (pares >= 6 && pares <= 9) score += 30;
    else score += 10;

    if (soma >= 180 && soma <= 220) score += 30;
    else score += 15;

    return score;
  }

  function exibirJogos(jogos) {
    const container = document.getElementById('jogosContainer');
    container.innerHTML = '';
    jogos.forEach(jogo => {
      const pares = jogo.filter(n => n % 2 === 0).length;
      const impares = 15 - pares;
      const soma = jogo.reduce((a,b) => a+b, 0);
      const repetidas = jogo.filter(n => (ultimosResultados[0] || []).includes(n)).length;
      const forca = calcularForcaJogo(repetidas, pares, soma);

      const div = document.createElement('div');
      div.className = 'jogo';

      const numerosDiv = document.createElement('div');
      numerosDiv.className = 'numeros';
      jogo.forEach(n => {
        const bola = document.createElement('div');
        bola.className = 'bola';
        bola.textContent = n.toString().padStart(2,'0');
        numerosDiv.appendChild(bola);
      });

      const statsDiv = document.createElement('div');
      statsDiv.className = 'stats';
      statsDiv.innerHTML = `
        P: ${pares} | I: ${impares} | Σ: ${soma}<br>
        Repetidas: ${repetidas}<br>
        Estimativa de Força: ${forca}%
      `;

      div.appendChild(numerosDiv);
      div.appendChild(statsDiv);
      container.appendChild(div);
    });
  }

  function gerarJogosBaseados() {
    const qtd = parseInt(document.getElementById('quantidadeJogos').value) || 10;
    const jogos = [];
    for(let i=0; i<qtd; i++){
      jogos.push(gerarJogoBaseado());
    }
    exibirJogos(jogos);
  }

  function apagarJogos(){
    const container = document.getElementById('jogosContainer');
    container.innerHTML = '';
  }

  async function atualizarPeriodicamente(){
    const concursosAtualizados = await puxarUltimos100();
    processarConcursos(concursosAtualizados);
    gerarJogosBaseados();
  }

  async function init(){
    const concursos = await puxarUltimos100();
    processarConcursos(concursos || []);
    gerarJogosBaseados();
    setInterval(atualizarPeriodicamente, 600000);
  }

  init();
</script>
</body>
</html>
